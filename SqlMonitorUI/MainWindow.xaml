<Window x:Class="SqlMonitorUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:SqlMonitorUI"
        Title="SQLDBA's SQL Server Health Monitor" 
        Height="850" 
        Width="1600"
        WindowStartupLocation="CenterScreen"
        WindowStyle="ToolWindow"
        Background="#F5F5F5">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header - Simplified -->
        <Border Grid.Row="0" Background="#0078D4">
            <Grid Margin="15,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="SQL Server Health Monitor" 
                               FontSize="20" 
                               FontWeight="SemiBold" 
                               Foreground="White"/>
                    <TextBlock x:Name="LastUpdateText" 
                               Text=" - Ready" 
                               FontSize="12" 
                               Foreground="#C0C0C0" 
                               VerticalAlignment="Center"
                               Margin="10,0,0,0"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" 
                            HorizontalAlignment="Right" 
                            VerticalAlignment="Center">

                    <TextBox x:Name="ConnectionStringTextBox"
                             Width="280"
                             Padding="8"
                             FontSize="11"
                             VerticalContentAlignment="Center"
                             Text="Server=localhost;Database=master;Integrated Security=true;TrustServerCertificate=true;"/>

                    <Button x:Name="ConnectButton" 
                            Content="ðŸ”Œ Connect" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="ConnectButton_Click"
                            Margin="5,0,0,0"
                            ToolTip="Configure connection settings"/>

                    <Button x:Name="ScriptManagerButton" 
                            Content="âš™ï¸ Config" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="ScriptManagerButton_Click"
                            Margin="5,0,0,0"
                            ToolTip="Manage scripts and live monitoring queries"/>

                    <Button x:Name="RunCompleteHealthCheckButton" 
                            Content="ðŸ¥ Full Audit" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="RunCompleteHealthCheckButton_Click"
                            Margin="5,0,0,0"
                            ToolTip="Run all diagnostic scripts and export to CSV"/>

                    <Button x:Name="UploadtoAzure" 
                            Content="ðŸ“¤ Upload" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="RunUploadtoAzureButton_Click"
                            Margin="5,0,0,0"
                            ToolTip="Upload results to SQLDBA" 
                            IsEnabled="False"
                            Foreground="Gray"/>

                    <Button x:Name="AboutInfo" 
                            Content="ðŸ“–" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="AboutButton_Click"
                            Width="40"
                            Margin="5,0,0,0"
                            ToolTip="About this tool"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main TabControl -->
        <TabControl Grid.Row="1" x:Name="MainTabControl" Margin="10" SelectionChanged="MainTabControl_SelectionChanged">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Padding" Value="20,10"/>
                    <Setter Property="FontSize" Value="14"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                </Style>
            </TabControl.Resources>

            <!-- Tab 1: Quick Checks -->
            <TabItem Header="ðŸ”„ Quick Checks" x:Name="QuickChecksTab">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Statistics Cards -->
                    <Grid Grid.Row="0" Margin="5,10,5,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- SQL Instances Card -->
                        <Border Grid.Column="0" Style="{StaticResource CardStyle}" 
                                x:Name="InstancesCard" 
                                MouseLeftButtonUp="InstancesCard_Click" 
                                Cursor="Hand"
                                ToolTip="Click to clear server filter">
                            <StackPanel>
                                <TextBlock Text="INSTANCES" Style="{StaticResource StatLabelStyle}"/>
                                <TextBlock x:Name="InstanceCountText" 
                                           Text="0" 
                                           Style="{StaticResource StatNumberStyle}"
                                           Foreground="#6B69D6"/>
                            </StackPanel>
                        </Border>

                        <!-- Total Checks Card -->
                        <Border Grid.Column="1" Style="{StaticResource CardStyle}" 
                                x:Name="TotalCard" 
                                MouseLeftButtonUp="TotalCard_Click" 
                                Cursor="Hand"
                                ToolTip="Click to show all checks">
                            <StackPanel>
                                <TextBlock Text="TOTAL" Style="{StaticResource StatLabelStyle}"/>
                                <TextBlock x:Name="TotalChecksText" 
                                           Text="0" 
                                           Style="{StaticResource StatNumberStyle}"
                                           Foreground="#444444"/>
                            </StackPanel>
                        </Border>

                        <!-- Passed Card -->
                        <Border Grid.Column="2" Style="{StaticResource CardStyle}" 
                                x:Name="PassedCard" 
                                MouseLeftButtonUp="PassedCard_Click" 
                                Cursor="Hand"
                                ToolTip="Click to filter passed checks">
                            <StackPanel>
                                <TextBlock Text="PASSED" Style="{StaticResource StatLabelStyle}"/>
                                <TextBlock x:Name="PassedChecksText" 
                                           Text="0" 
                                           Style="{StaticResource StatNumberStyle}"
                                           Foreground="{StaticResource SuccessBrush}"/>
                            </StackPanel>
                        </Border>

                        <!-- Critical Card -->
                        <Border Grid.Column="3" Style="{StaticResource CardStyle}" 
                                x:Name="CriticalCard" 
                                MouseLeftButtonUp="CriticalCard_Click" 
                                Cursor="Hand"
                                ToolTip="Click to filter critical issues">
                            <StackPanel>
                                <TextBlock Text="CRITICAL" Style="{StaticResource StatLabelStyle}"/>
                                <TextBlock x:Name="CriticalIssuesText" 
                                           Text="0" 
                                           Style="{StaticResource StatNumberStyle}"
                                           Foreground="{StaticResource CriticalBrush}"/>
                            </StackPanel>
                        </Border>

                        <!-- Warning Card -->
                        <Border Grid.Column="4" Style="{StaticResource CardStyle}" 
                                x:Name="WarningCard" 
                                MouseLeftButtonUp="WarningCard_Click" 
                                Cursor="Hand"
                                ToolTip="Click to filter warnings">
                            <StackPanel>
                                <TextBlock Text="WARNING" Style="{StaticResource StatLabelStyle}"/>
                                <TextBlock x:Name="WarningIssuesText" 
                                           Text="0" 
                                           Style="{StaticResource StatNumberStyle}"
                                           Foreground="{StaticResource WarningBrush}"/>
                            </StackPanel>
                        </Border>

                        <!-- Info Card -->
                        <Border Grid.Column="5" Style="{StaticResource CardStyle}" 
                                x:Name="InfoCard" 
                                MouseLeftButtonUp="InfoCard_Click" 
                                Cursor="Hand"
                                ToolTip="Click to filter info items">
                            <StackPanel>
                                <TextBlock Text="INFO" Style="{StaticResource StatLabelStyle}"/>
                                <TextBlock x:Name="InfoIssuesText" 
                                           Text="0" 
                                           Style="{StaticResource StatNumberStyle}"
                                           Foreground="{StaticResource InfoBrush}"/>
                            </StackPanel>
                        </Border>

                        <!-- Run Button -->
                        <Button Grid.Column="6" 
                                x:Name="RunChecksButton"
                                Content="â–¶ Run Checks" 
                                Click="RunChecksButton_Click"
                                Background="#107C10"
                                Foreground="White"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Padding="20,15"
                                Margin="10,5,5,5"
                                BorderThickness="0"
                                Cursor="Hand"/>
                    </Grid>

                    <!-- Main Content Area -->
                    <Grid Grid.Row="1" Margin="5,5,5,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Filter Sidebar -->
                        <Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,5,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Categories Section -->
                                <TextBlock Grid.Row="0" Text="Categories" Style="{StaticResource HeaderTextStyle}"/>

                                <ListBox x:Name="CategoryListBox" 
                                         Grid.Row="1"
                                         BorderThickness="0"
                                         Background="Transparent"
                                         SelectionChanged="CategoryListBox_SelectionChanged"
                                         MaxHeight="180"
                                         VirtualizingStackPanel.IsVirtualizing="True"
                                         VirtualizingStackPanel.VirtualizationMode="Recycling">
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Padding" Value="8"/>
                                            <Setter Property="Margin" Value="0,2"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="ListBoxItem">
                                                        <Border x:Name="Border" 
                                                                Background="Transparent" 
                                                                CornerRadius="3"
                                                                Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter/>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsSelected" Value="True">
                                                                <Setter TargetName="Border" Property="Background" Value="#E3F2FD"/>
                                                            </Trigger>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter TargetName="Border" Property="Background" Value="#F5F5F5"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Name}" FontSize="12"/>
                                                <TextBlock Text="{Binding Count, StringFormat=' ({0})'}" 
                                                           Foreground="#888888" FontSize="11"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <!-- Servers Section -->
                                <TextBlock Grid.Row="2" Text="Servers" Style="{StaticResource HeaderTextStyle}" Margin="0,10,0,0"/>

                                <ListBox x:Name="ServerListBox" 
                                         Grid.Row="3"
                                         BorderThickness="0"
                                         Background="Transparent"
                                         SelectionChanged="ServerListBox_SelectionChanged"
                                         MaxHeight="180"
                                         VirtualizingStackPanel.IsVirtualizing="True"
                                         VirtualizingStackPanel.VirtualizationMode="Recycling">
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Padding" Value="8"/>
                                            <Setter Property="Margin" Value="0,2"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="ListBoxItem">
                                                        <Border x:Name="Border" 
                                                                Background="Transparent" 
                                                                CornerRadius="3"
                                                                Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter/>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsSelected" Value="True">
                                                                <Setter TargetName="Border" Property="Background" Value="#E3F2FD"/>
                                                            </Trigger>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter TargetName="Border" Property="Background" Value="#F5F5F5"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Name}" FontSize="12"/>
                                                <TextBlock Text="{Binding Count, StringFormat=' ({0})'}" 
                                                           Foreground="#888888" FontSize="11"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>
                        </Border>

                        <!-- Results Area -->
                        <Border Grid.Column="1" Style="{StaticResource CardStyle}" Margin="5,0,0,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Results Header -->
                                <Grid Grid.Row="0" Margin="0,0,0,10">
                                    <TextBlock Text="Check Results" 
                                               Style="{StaticResource HeaderTextStyle}"
                                               VerticalAlignment="Center"/>
                                    <TextBox x:Name="SearchTextBox" 
                                             Width="250" 
                                             HorizontalAlignment="Right"
                                             Padding="8"
                                             FontSize="12"
                                             TextChanged="SearchTextBox_TextChanged"
                                             VerticalContentAlignment="Center">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <Trigger Property="Text" Value="">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush Stretch="None" AlignmentX="Left">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="ðŸ” Search checks..." 
                                                                                   Foreground="#AAAAAA" 
                                                                                   Margin="8,0,0,0"
                                                                                   FontSize="12"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                </Grid>

                                <!-- DataGrid Results -->
                                <DataGrid Grid.Row="1"
                                          x:Name="ResultsDataGrid"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          GridLinesVisibility="None"
                                          HeadersVisibility="Column"
                                          RowHeight="40"
                                          AlternatingRowBackground="#FAFAFA"
                                          BorderThickness="0"
                                          CanUserResizeRows="False"
                                          SelectionMode="Single"
                                          EnableRowVirtualization="True"
                                          EnableColumnVirtualization="True"
                                          VirtualizingStackPanel.IsVirtualizing="True"
                                          VirtualizingStackPanel.VirtualizationMode="Recycling">

                                    <DataGrid.Resources>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="Background" Value="#F0F0F0"/>
                                            <Setter Property="Foreground" Value="#333333"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="Padding" Value="8"/>
                                            <Setter Property="Height" Value="35"/>
                                            <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                            <Setter Property="BorderBrush" Value="#DDDDDD"/>
                                        </Style>
                                        <Style TargetType="DataGridCell">
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="Padding" Value="8,0"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="Background" Value="#E3F2FD"/>
                                                    <Setter Property="Foreground" Value="#000000"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.Resources>

                                    <DataGrid.Columns>
                                        <DataGridTemplateColumn Header="" Width="40">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Ellipse Width="12" Height="12" Fill="{Binding StatusColor}"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>

                                        <DataGridTextColumn Header="Server" 
                                                            Binding="{Binding ServerName}" 
                                                            Width="100"
                                                            FontSize="11"/>

                                        <DataGridTextColumn Header="Check Name" 
                                                            Binding="{Binding CheckName}" 
                                                            Width="*"
                                                            FontSize="12"
                                                            FontWeight="Medium"/>

                                        <DataGridTextColumn Header="Category" 
                                                            Binding="{Binding Category}" 
                                                            Width="100"
                                                            FontSize="11"/>

                                        <DataGridTemplateColumn Header="Severity" Width="80">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Border Background="{Binding SeverityBackground}" 
                                                            CornerRadius="3" 
                                                            Padding="6,2">
                                                        <TextBlock Text="{Binding Severity}" 
                                                                   Foreground="White" 
                                                                   FontSize="10" 
                                                                   FontWeight="SemiBold"
                                                                   HorizontalAlignment="Center"/>
                                                    </Border>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>

                                        <DataGridTemplateColumn Header="Status" Width="80">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Status}" 
                                                               FontSize="11"
                                                               FontWeight="SemiBold"
                                                               Foreground="{Binding StatusColor}"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>

                                        <DataGridTextColumn Header="Details" 
                                                            Binding="{Binding Message}" 
                                                            Width="2*"
                                                            FontSize="11"
                                                            Foreground="#555555"/>

                                        <DataGridTextColumn Header="Checked" 
                                                            Binding="{Binding ExecutedAtFormatted}" 
                                                            Width="120"
                                                            FontSize="10"
                                                            Foreground="#777777"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <!-- Empty State -->
                                <StackPanel Grid.Row="1" 
                                            x:Name="EmptyStatePanel"
                                            VerticalAlignment="Center" 
                                            HorizontalAlignment="Center"
                                            Visibility="Collapsed">
                                    <TextBlock Text="ðŸ“Š" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                    <TextBlock Text="No checks have been run yet" 
                                               FontSize="16" 
                                               Foreground="#888888"
                                               HorizontalAlignment="Center"/>
                                    <TextBlock Text="Click 'Run Checks' to start monitoring" 
                                               FontSize="12" 
                                               Foreground="#AAAAAA"
                                               HorizontalAlignment="Center"
                                               Margin="0,5,0,0"/>
                                </StackPanel>

                                <!-- Loading Indicator -->
                                <StackPanel Grid.Row="1"
                                            x:Name="LoadingPanel"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Center"
                                            Visibility="Collapsed">
                                    <TextBlock Text="â³" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                    <TextBlock Text="Running health checks..." 
                                               FontSize="16" 
                                               Foreground="#888888"
                                               HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>
            </TabItem>

            <!-- Tab 2: Live Monitor -->
            <TabItem Header="ðŸ“Š Live Monitor" x:Name="LiveMonitorTab">
                <Grid x:Name="LiveMonitorContainer">
                    <!-- Live Monitor content will be embedded here -->
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" x:Name="LiveMonitorPlaceholder">
                        <TextBlock Text="ðŸ“Š" FontSize="64" HorizontalAlignment="Center" Margin="0,0,0,15"/>
                        <TextBlock Text="Live Monitor" 
                                   FontSize="20" 
                                   FontWeight="SemiBold"
                                   Foreground="#333333"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="Connect to a server to enable live monitoring" 
                                   FontSize="13" 
                                   Foreground="#888888"
                                   HorizontalAlignment="Center"
                                   Margin="0,10,0,20"/>
                        <Button x:Name="StartLiveMonitorButton"
                                Content="â–¶ Start Live Monitor"
                                Click="StartLiveMonitorButton_Click"
                                Background="#0078D4"
                                Foreground="White"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Padding="25,12"
                                BorderThickness="0"
                                Cursor="Hand"
                                IsEnabled="False"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Tab 3: Manage Checks (optional - can be accessed from button too) -->
            <TabItem Header="âš™ï¸ Manage Checks" x:Name="ManageChecksTab" Visibility="Collapsed">
                <Grid x:Name="ManageChecksContainer">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="âš™ï¸" FontSize="64" HorizontalAlignment="Center" Margin="0,0,0,15"/>
                        <TextBlock Text="Check Manager" 
                                   FontSize="20" 
                                   FontWeight="SemiBold"
                                   Foreground="#333333"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="View and edit health check definitions" 
                                   FontSize="13" 
                                   Foreground="#888888"
                                   HorizontalAlignment="Center"
                                   Margin="0,10,0,20"/>
                        <Button x:Name="OpenCheckManagerButton"
                                Content="Open Check Manager"
                                Click="ManageChecksButton_Click"
                                Background="#6B69D6"
                                Foreground="White"
                                FontSize="14"
                                Padding="25,12"
                                BorderThickness="0"
                                Cursor="Hand"/>
                    </StackPanel>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
