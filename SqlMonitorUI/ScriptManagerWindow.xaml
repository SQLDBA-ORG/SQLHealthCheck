<Window x:Class="SqlMonitorUI.ScriptManagerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Configuration Manager - Scripts &amp; Live Monitoring" 
        Height="750" 
        Width="1400"
        WindowStyle="ToolWindow" WindowStartupLocation="CenterOwner"
        Background="#F5F5F5">
    
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="Configuration Manager" 
                       FontSize="22" 
                       FontWeight="SemiBold" 
                       Foreground="#333333"/>
            <TextBlock Text="Manage diagnostic scripts and live monitoring SQL queries"
                       FontSize="13"
                       Foreground="#666666"
                       Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Tab Control -->
        <TabControl Grid.Row="1" x:Name="MainTabControl">
            
            <!-- Tab 1: Diagnostic Scripts -->
            <TabItem Header="üìú Diagnostic Scripts" Padding="15,8">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Instructions -->
                    <Border Grid.Row="0" 
                            Background="#FFF3E0" 
                            BorderBrush="#FFB74D" 
                            BorderThickness="1" 
                            CornerRadius="4"
                            Padding="12"
                            Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock FontWeight="SemiBold" Foreground="#E65100">üìÅ Setup Instructions:</TextBlock>
                            <TextBlock TextWrapping="Wrap" Foreground="#E65100" Margin="0,5,0,0">
                                1. Create a "scripts" folder in the application directory
                                2. Copy your diagnostic scripts (sp_Blitz.sql, sp_triage.sql, etc.) into the scripts folder
                                3. Click "Scan Scripts Folder" to detect and configure scripts
                                4. Use "SQL Query For Output" to specify a custom query for CSV export
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Toolbar -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Content="üìÇ Scan Scripts Folder"
                                Click="ScanScriptsButton_Click"
                                Padding="15,8"
                                Margin="0,0,10,0"
                                Background="#0078D4"
                                Foreground="White"
                                BorderThickness="0"
                                FontSize="12"
                                Cursor="Hand" IsEnabled="False"/>
                        
                        <Button Content="‚ûï Add Script"
                                Click="AddScriptButton_Click"
                                Padding="15,8"
                                Margin="0,0,10,0"
                                Background="#107C10"
                                Foreground="White"
                                BorderThickness="0"
                                FontSize="12"
                                Cursor="Hand"/>
                        
                        <Button Content="üóëÔ∏è Remove Selected"
                                Click="RemoveScriptButton_Click"
                                Padding="15,8"
                                Margin="0,0,10,0"
                                Background="#D83B01"
                                Foreground="White"
                                BorderThickness="0"
                                FontSize="12"
                                Cursor="Hand"/>

                        <Button Content="üìÅ Open Scripts Folder"
                                Click="OpenScriptsFolderButton_Click"
                                Padding="15,8"
                                Background="#6B69D6"
                                Foreground="White"
                                BorderThickness="0"
                                FontSize="12"
                                Cursor="Hand"/>
                    </StackPanel>

                    <!-- Scripts Grid -->
                    <DataGrid Grid.Row="2"
                              x:Name="ScriptsDataGrid"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              SelectionMode="Single"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              AlternatingRowBackground="#F9F9F9"
                              RowBackground="White"
                              BorderBrush="#CCCCCC"
                              BorderThickness="1"
                              FontSize="12"
                              EnableRowVirtualization="True"
                              VirtualizingStackPanel.IsVirtualizing="True">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="Enabled" 
                                                    Binding="{Binding Enabled, UpdateSourceTrigger=PropertyChanged}"
                                                    Width="60"/>
                            <DataGridTextColumn Header="Name" 
                                                Binding="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="120"/>
                            <DataGridTextColumn Header="Script File" 
                                                Binding="{Binding ScriptPath}" 
                                                Width="140"
                                                IsReadOnly="True"/>
                            <DataGridTextColumn Header="Execution Parameters" 
                                                Binding="{Binding ExecutionParameters, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="200"/>
                            <DataGridTextColumn Header="SQL Query For Output (CSV)" 
                                                Binding="{Binding SqlQueryForOutput, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="*"
                                                MinWidth="250">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                        <Setter Property="ToolTip" Value="{Binding SqlQueryForOutput}"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                                <DataGridTextColumn.EditingElementStyle>
                                    <Style TargetType="TextBox">
                                        <Setter Property="TextWrapping" Value="Wrap" />
                                        <Setter Property="AcceptsReturn" Value="true" />
                                    </Style>
                                </DataGridTextColumn.EditingElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Order" 
                                                Binding="{Binding ExecutionOrder, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="50"/>
                            <DataGridTextColumn Header="Timeout" 
                                                Binding="{Binding TimeoutSeconds, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="60"/>
                            <DataGridCheckBoxColumn Header="CSV" 
                                                    Binding="{Binding ExportToCsv, UpdateSourceTrigger=PropertyChanged}"
                                                    Width="45"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Tab 2: Live Monitoring Queries -->
            <TabItem Header="üìä Live Monitoring Queries" Padding="15,8">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Instructions -->
                    <Border Grid.Row="0" 
                            Background="#E3F2FD" 
                            BorderBrush="#2196F3" 
                            BorderThickness="1" 
                            CornerRadius="4"
                            Padding="12"
                            Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock FontWeight="SemiBold" Foreground="#1565C0">‚ö° Live Monitoring Configuration:</TextBlock>
                            <TextBlock TextWrapping="Wrap" Foreground="#1565C0" Margin="0,5,0,0">
                                Configure SQL queries used by the Live Monitoring window. Changes are auto-saved and take effect immediately.
                                Increase "Refresh Every N Ticks" for expensive queries on busy servers. Set "Enabled" to false to disable a query.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Global Settings -->
                    <Border Grid.Row="1" 
                            Background="White" 
                            BorderBrush="#CCCCCC" 
                            BorderThickness="1" 
                            CornerRadius="4"
                            Padding="15"
                            Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="Global Settings" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Refresh Interval (ms):" VerticalAlignment="Center" Width="140"/>
                                <TextBox x:Name="RefreshIntervalTextBox" Width="80" Margin="0,0,30,0" Text="1000"/>
                                
                                <TextBlock Text="Default Query Timeout (sec):" VerticalAlignment="Center" Width="160"/>
                                <TextBox x:Name="QueryTimeoutTextBox" Width="80" Text="30"/>
                                
                                <Button Content="üîÑ Reload from File"
                                        Click="ReloadLiveConfigButton_Click"
                                        Padding="15,5"
                                        Margin="30,0,0,0"
                                        Background="#0078D4"
                                        Foreground="White"
                                        BorderThickness="0"
                                        FontSize="12"
                                        Cursor="Hand"/>
                                
                                <Button Content="üìÑ Open Config File"
                                        Click="OpenLiveConfigFileButton_Click"
                                        Padding="15,5"
                                        Margin="10,0,0,0"
                                        Background="#6B69D6"
                                        Foreground="White"
                                        BorderThickness="0"
                                        FontSize="12"
                                        Cursor="Hand"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Queries Grid -->
                    <DataGrid Grid.Row="2"
                              x:Name="LiveQueriesDataGrid"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              SelectionMode="Single"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              AlternatingRowBackground="#F9F9F9"
                              RowBackground="White"
                              BorderBrush="#CCCCCC"
                              BorderThickness="1"
                              FontSize="12"
                              RowHeight="35"
                              EnableRowVirtualization="True"
                              VirtualizingStackPanel.IsVirtualizing="True">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="Enabled" 
                                                    Binding="{Binding Enabled, UpdateSourceTrigger=PropertyChanged}"
                                                    Width="60"/>
                            <DataGridTextColumn Header="Query Name" 
                                                Binding="{Binding Name}" 
                                                Width="120"
                                                IsReadOnly="True"/>
                            <DataGridTextColumn Header="Description" 
                                                Binding="{Binding Description, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="200"/>
                            <DataGridTextColumn Header="Timeout (sec)" 
                                                Binding="{Binding TimeoutSeconds, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="90"/>
                            <DataGridTextColumn Header="Refresh Every N Ticks" 
                                                Binding="{Binding RefreshEveryNTicks, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="130"/>
                            <DataGridTemplateColumn Header="Edit SQL" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Edit SQL" 
                                                Click="EditLiveQueryButton_Click"
                                                Tag="{Binding}"
                                                Padding="8,3"
                                                Background="#0078D4"
                                                Foreground="White"
                                                BorderThickness="0"
                                                FontSize="11"
                                                Cursor="Hand"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="SQL Preview" 
                                                Binding="{Binding SqlPreview}" 
                                                Width="*"
                                                IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                        <Setter Property="ToolTip" Value="{Binding Sql}"/>
                                        <Setter Property="Foreground" Value="#666666"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Bottom Buttons -->
        <StackPanel Grid.Row="2" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Margin="0,15,0,0">
            <TextBlock x:Name="StatusText"
                       Text=""
                       VerticalAlignment="Center"
                       Margin="0,0,20,0"
                       FontSize="12"
                       Foreground="#666666"/>
            
            <Button Content="üíæ Save All"
                    Click="SaveButton_Click"
                    Padding="20,12"
                    Margin="0,0,10,0"
                    Background="#107C10"
                    Foreground="White"
                    BorderThickness="0"
                    FontSize="14"
                    FontWeight="SemiBold"
                    Cursor="Hand"/>
            <Button Content="Close"
                    Click="CloseButton_Click"
                    Padding="20,12"
                    Background="#666666"
                    Foreground="White"
                    BorderThickness="0"
                    FontSize="14"
                    Cursor="Hand"/>
        </StackPanel>
    </Grid>
</Window>
