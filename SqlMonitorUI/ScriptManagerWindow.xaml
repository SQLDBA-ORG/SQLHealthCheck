<Window x:Class="SqlMonitorUI.ScriptManagerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Script Manager - Embedded Diagnostic Scripts" 
        Height="700" 
        Width="1400"
        WindowStyle="ToolWindow" WindowStartupLocation="CenterOwner"
        Background="#F5F5F5">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,15">
            <TextBlock Text="Manage Diagnostic Scripts" 
                       FontSize="22" 
                       FontWeight="SemiBold" 
                       Foreground="#333333"/>
            <TextBlock Text="Configure embedded scripts like sp_Blitz, sp_triage, and custom diagnostic scripts"
                       FontSize="13"
                       Foreground="#666666"
                       Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Instructions -->
        <Border Grid.Row="1" 
                Background="#FFF3E0" 
                BorderBrush="#FFB74D" 
                BorderThickness="1" 
                CornerRadius="4"
                Padding="12"
                Margin="0,0,0,15">
            <StackPanel>
                <TextBlock FontWeight="SemiBold" Foreground="#E65100">üìÅ Setup Instructions:</TextBlock>
                <TextBlock TextWrapping="Wrap" Foreground="#E65100" Margin="0,5,0,0">
                    1. Create a "scripts" folder in the application directory
                    2. Copy your diagnostic scripts (sp_Blitz.sql, sp_triage.sql, etc.) into the scripts folder
                    3. Click "Scan Scripts Folder" to detect and configure scripts
                    4. Use "SQL Query For Output" to specify a custom query for CSV export (runs after Execution Parameters)
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Toolbar -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,15">
            <Button Content="üìÇ Scan Scripts Folder"
                    Click="ScanScriptsButton_Click"
                    Padding="15,10"
                    Margin="0,0,10,0"
                    Background="#0078D4"
                    Foreground="White"
                    BorderThickness="0"
                    FontSize="13"
                    Cursor="Hand" IsEnabled="False"/>
            
            <Button Content="‚ûï Add Script"
                    Click="AddScriptButton_Click"
                    Padding="15,10"
                    Margin="0,0,10,0"
                    Background="#107C10"
                    Foreground="White"
                    BorderThickness="0"
                    FontSize="13"
                    Cursor="Hand"/>
            
            <Button Content="üóëÔ∏è Remove Selected"
                    Click="RemoveScriptButton_Click"
                    Padding="15,10"
                    Margin="0,0,10,0"
                    Background="#D83B01"
                    Foreground="White"
                    BorderThickness="0"
                    FontSize="13"
                    Cursor="Hand"/>

            <Button Content="üìÅ Open Scripts Folder"
                    Click="OpenScriptsFolderButton_Click"
                    Padding="15,10"
                    Background="#6B69D6"
                    Foreground="White"
                    BorderThickness="0"
                    FontSize="13"
                    Cursor="Hand"/>
        </StackPanel>

        <!-- Scripts Grid -->
        <DataGrid Grid.Row="3"
                  x:Name="ScriptsDataGrid"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  SelectionMode="Single"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  AlternatingRowBackground="#F9F9F9"
                  RowBackground="White"
                  BorderBrush="#CCCCCC"
                  BorderThickness="1"
                  FontSize="12">
            <DataGrid.Columns>
                <DataGridCheckBoxColumn Header="Enabled" 
                                        Binding="{Binding Enabled, UpdateSourceTrigger=PropertyChanged}"
                                        Width="60"/>
                <DataGridTextColumn Header="Name" 
                                    Binding="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                                    Width="120"/>
                <DataGridTextColumn Header="Script File" 
                                    Binding="{Binding ScriptPath}" 
                                    Width="140"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Execution Parameters" 
                                    Binding="{Binding ExecutionParameters, UpdateSourceTrigger=PropertyChanged}" 
                                    Width="200"/>
                <DataGridTextColumn Header="SQL Query For Output (CSV)" 
                                    Binding="{Binding SqlQueryForOutput, UpdateSourceTrigger=PropertyChanged}" 
                                    Width="*"
                                    MinWidth="250">

                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                            <Setter Property="ToolTip" Value="{Binding SqlQueryForOutput}"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>


                    <DataGridTextColumn.EditingElementStyle>
                        <Style TargetType="TextBox">
                            <Setter Property="TextWrapping" Value="Wrap" />
                            <Setter Property="AcceptsReturn" Value="true" />
                        </Style>
                    </DataGridTextColumn.EditingElementStyle>
                    
                    
                </DataGridTextColumn>
                <DataGridTextColumn Header="Order" 
                                    Binding="{Binding ExecutionOrder, UpdateSourceTrigger=PropertyChanged}" 
                                    Width="50"/>
                <DataGridTextColumn Header="Timeout" 
                                    Binding="{Binding TimeoutSeconds, UpdateSourceTrigger=PropertyChanged}" 
                                    Width="60"/>
                <DataGridCheckBoxColumn Header="CSV" 
                                        Binding="{Binding ExportToCsv, UpdateSourceTrigger=PropertyChanged}"
                                        Width="45"/>
                <!-- Edit Query Button
                <DataGridTemplateColumn Header="SQL Query" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="Edit SQL" 
                      Click="EditSqlScriptButton_Click"
                      Tag="{Binding}"
                      Padding="8,4"
                      Background="#0078D4"
                      Foreground="White"
                      BorderThickness="0"
                      FontSize="11"
                      Cursor="Hand"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn> -->
            </DataGrid.Columns>
        </DataGrid>

        <!-- Bottom Buttons -->
        <StackPanel Grid.Row="4" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Margin="0,15,0,0">
            <TextBlock x:Name="StatusText"
                       Text=""
                       VerticalAlignment="Center"
                       Margin="0,0,20,0"
                       FontSize="12"
                       Foreground="#666666"/>
            
            <Button Content="üíæ Save Configuration"
                    Click="SaveButton_Click"
                    Padding="20,12"
                    Margin="0,0,10,0"
                    Background="#107C10"
                    Foreground="White"
                    BorderThickness="0"
                    FontSize="14"
                    FontWeight="SemiBold"
                    Cursor="Hand"/>
            <Button Content="Close"
                    Click="CloseButton_Click"
                    Padding="20,12"
                    Background="#666666"
                    Foreground="White"
                    BorderThickness="0"
                    FontSize="14"
                    Cursor="Hand"/>
        </StackPanel>
    </Grid>
</Window>
